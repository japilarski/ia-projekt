---
title: ""
author: ""
date: "`r Sys.Date()`"
output: 
  html_document:
    toc: true
    theme: paper
theme: paper
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(ggcorrplot)
library(readxl)
library(dplyr)
library(ggplot2)
library(tidyr)
library(psych)
library(scales)
library(patchwork)
library(kableExtra)
library(grid)
library(tidyverse)
library(quadprog)
library(PerformanceAnalytics)
library(timeSeries)
library(lpSolve)
library(fPortfolio)

# euro_pln, mci_pln, pkn_pln, xau_pln
euro_pln <- read.csv("euro_pln.csv")[2:107, ]
mci_pln <- read.csv("mci_pln.csv")[2:107, ]
pkn_pln <- read.csv("pkn_pln.csv")[2:107, ]
xau_pln <- read.csv("xau_pln.csv")[2:107, ]
euro_pln$Data <- as.Date(euro_pln$Data, format = "%Y-%m-%d")
mci_pln$Data <- as.Date(mci_pln$Data, format = "%Y-%m-%d")
pkn_pln$Data <- as.Date(pkn_pln$Data, format = "%Y-%m-%d")
xau_pln$Data <- as.Date(xau_pln$Data, format = "%Y-%m-%d")
```

## WstÄ™p

Przeprowadzona analiza dotyczy portfela inwestycyjnego zÅ‚oÅ¼onego z 3 inwestycji alternatywnych z trzech rÃ³Å¼nych kategorii miÄ™dzy innymi metale szlachetne, waluty, fundusze oraz akcje polskiego przedsiÄ™buorstwa wchodzÄ…cego w skÅ‚ad indeksu WIG30. Wybrane aktywa do portfelu inwestycyjnego to zÅ‚oto, euro, fundusz MCI oraz aktywa PKN Orlen. Do przeprowadzonej analizy wykorzystano ceny zamkniÄ™cia w interwale dziennym zaczynajÄ…c od 1 lipca 2024 do 29 listopada 2024. Celem analizy jest przeprowadzenie badania portfela inwestycyjnego w oparciu o miary statystyczne, efektywnoÅ›ciowe oraz miary ryzyka.

## Charakterystyka inwestycji

### **MCI Capital ASI SA** - fundusz inwestycyjny

Jest polska Alternatywna SpÃ³Å‚ka Inwestycyjna (ASI), czyli fundusz, ktÃ³ry oferuje inwestorom alternatywne opcje inwestycyjne, ktÃ³re charakteryzujÄ… siÄ™ wyÅ¼szym ryzykiem, ale mogÄ… przynieÅ›Ä‡ atrakcyjniejsze zwroty, ktÃ³re nie sÄ… dostÄ™pne w ramach tradycyjnych funduszy inwestycyjnych. Specjalizuje siÄ™ w inwestycjach zwiÄ…zanych z cyfrowÄ… transformacjÄ… gospodarki oraz innowacyjnymi modelami biznesowymi. Aktualne portfolio funduszu obejmuje 14 aktywnych inwestycji w takich obszarach jak e-commerce, fintech, SaaS, cloud gaming, rynki internetowe oraz technologie zwiÄ…zane z zielonÄ… transformacjÄ… i klimatem (climatech). Fundusz koncentruje siÄ™ na wspieraniu firm, ktÃ³re wprowadzajÄ… innowacyjne rozwiÄ…zania w swoich branÅ¼ach, a takÅ¼e na wspieraniu rozwoju infrastruktury internetowej.

### **PKN ORLEN SA**

PKN ORLEN SA to polski koncern multienergetyczny, ktÃ³ry dziaÅ‚a w sektorze naftowym, gazowym, petrochemicznym oraz energii odnawialnej. Jest jednym z najwiÄ™kszych przedsiÄ™biorstw w Europie Åšrodkowo-Wschodniej, notowanym na GieÅ‚dzie PapierÃ³w WartoÅ›ciowych w Warszawie.
PKN ORLEN posiada rozwiniÄ™tÄ… sieÄ‡ stacji paliwowych w Polsce oraz w regionie Europy Åšrodkowo-Wschodniej, oferujÄ…c szerokÄ… gamÄ™ produktÃ³w i usÅ‚ug, w tym programy lojalnoÅ›ciowe oraz rozwiÄ…zania z zakresu elektromobilnoÅ›ci. Portfolio spÃ³Å‚ki obejmuje rÃ³wnieÅ¼ zaawansowane technologie petrochemiczne oraz produkty chemiczne, ktÃ³re znajdujÄ… zastosowanie w wielu branÅ¼ach przemysÅ‚owych.
ORLEN jest liderem w branÅ¼y energetycznej w Polsce, a jego strategiczne inwestycje przyczyniajÄ… siÄ™ do zwiÄ™kszenia bezpieczeÅ„stwa energetycznego kraju oraz wsparcia transformacji w kierunku gospodarki niskoemisyjnej.

### **ZÅOTO**

ZÅ‚oto to metal szlachetny o symbolu chemicznym Au i numerze atomowym 79. Jest jednym z najbardziej cenionych surowcÃ³w na Å›wiecie, znanym ze swojej trwaÅ‚oÅ›ci, odpornoÅ›ci na korozjÄ™ i wyjÄ…tkowego, Å¼Ã³Å‚tego koloru.
ZÅ‚oto wystÄ™puje w naturze w postaci czystych bryÅ‚ek (zÅ‚oto rodzimne) lub w postaci zwiÄ…zkÃ³w z innymi pierwiastkami. Wykorzystywane jest gÅ‚Ã³wnie w jubilerstwie, ale ma takÅ¼e szerokie zastosowanie w elektronice, medycynie, przemyÅ›le i finansach. ZÅ‚oto jest uwaÅ¼ane za bezpiecznÄ… inwestycjÄ™ w okresach kryzysÃ³w gospodarczych.


## Statystyki opisowe

Przy wykonywaniu statystyk opisowych dla stÃ³p zwrotu wybÃ³r miÄ™dzy zmianÄ… procentowÄ… a logarytmicznÄ… stopÄ… zwrotu zaleÅ¼y od celu analizy oraz wÅ‚aÅ›ciwoÅ›ci danych. Oba wskaÅºniki majÄ… swoje zalety i sÄ… stosowane w rÃ³Å¼nych kontekstach.

Dla danych finansowych, analizowanych w tym rozdziale, zastosowane procentowÄ… stopÄ™ zwrotu, poniewaÅ¼ daje ona Å‚atwoÅ›Ä‡ interpretacji oraz pozwala na porÃ³wnanie miÄ™dzy rÃ³Å¼nymi aktywami. Procentowa stopa zwrotu jest wyraÅ¼ana jako procentowa zmiana wartoÅ›ci aktywa w okreÅ›lonym okresie. Jest to wskaÅºnik, ktÃ³ry informuje o wzroÅ›cie lub spadku wartoÅ›ci aktywa w danym okresie. 

### Wykresy cen wybranych aktywÃ³w
Na poniÅ¼szych wykresach zaobserowaÄ‡ moÅ¼na procentowe zmiany ceny poszczegÃ³lnych aktywÃ³w na przestrzeni okresu okoÅ‚o 4 miesiÄ™cy. 

```{r wykresy_cen, eval=TRUE, echo = FALSE, fig.height=8, fig.align='center'}
w1 <- ggplot(euro_pln, aes(x = Data, y = pct_change, group = 1)) +
  geom_line() +
  ggtitle("EUR/PLN") +
  theme(axis.title.y = element_blank(), axis.title.x = element_blank()) +
  scale_y_continuous(labels = label_percent(scale = 1))

w2 <- ggplot(mci_pln, aes(x = Data, y = pct_change, group = 1)) +
  geom_line() +
  ggtitle("MCI") +
  theme(axis.title.y = element_blank(), axis.title.x = element_blank()) +
  scale_y_continuous(labels = label_percent(scale = 1))

w3 <- ggplot(pkn_pln, aes(x = Data, y = pct_change, group = 1)) +
  geom_line() +
  ggtitle("PKN") +
  theme(axis.title.y = element_blank(), axis.title.x = element_blank()) +
  scale_y_continuous(labels = label_percent(scale = 1))

w4 <- ggplot(xau_pln, aes(x = Data, y = pct_change, group = 1)) +
  geom_line() +
  ggtitle("XAU/PLN") +
  theme(axis.title.y = element_blank(), axis.title.x = element_blank()) +
  scale_y_continuous(labels = label_percent(scale = 1))

combined <- w1 / w2 / w3 / w4

grid.draw(
  gridExtra::grid.arrange(
    grobs = list(textGrob(
      "Dzienna procentowy zwrot z inwestycji",
      rot = 90,
      gp = gpar(fontsize = 12)
    ),
    patchworkGrob(combined)),
    ncol = 2,
    widths = c(1, 10)
  )
)

```

### Wykresy pudeÅ‚kowe
PoniÅ¼sze wykresy pudeÅ‚kowe przedstawiajÄ… rozkÅ‚ad zmiennych, ukazujÄ…c ich centralnÄ… tendencjÄ™, rozproszenie oraz obecnoÅ›Ä‡ wartoÅ›ci odstajÄ…cych. Na wykresie widaÄ‡ kilka kluczowych elementÃ³w opisanych poniÅ¼ej. Dla Å‚atwiejszej interpretacji wykresy zostaÅ‚y jednolicie wyskalowane aby uÅ‚atwiÄ‡ porÃ³wnanie miÄ™dzy aktywami.

1. PudeÅ‚ko, ktÃ³re reprezentuje zakres miÄ™dzy 25. a 75. percentylem (Q1 i Q3), obrazujÄ…c zakres interkwartylowy. Wykres ten pokazuje, w jakim przedziale znajduje siÄ™ poÅ‚owa danych, wskazujÄ…c na stopieÅ„ koncentracji wartoÅ›ci wokÃ³Å‚ mediany. SzczegÃ³lnie w przypadku cen euro, pudeÅ‚ko jest wÄ…skie, co sugeruje mniejsze rozproszenie cen w analizowanym okresie.
2. Linia wewnÄ…trz pudeÅ‚ka wskazuje Å›rodek rozkÅ‚adu, dzielÄ…c dane na dwie rÃ³wne czÄ™Å›ci. PoÅ‚oÅ¼enie mediany wzglÄ™dem pudeÅ‚ka informuje o symetrii rozkÅ‚adu danych. W analizowanych danych mediana jest zazwyczaj blisko Å›rodka pudeÅ‚ka, co sugeruje symetryczny rozkÅ‚ad. Jedynym zauwaÅ¼alnym wyjÄ…tkiem jest PKN, gdzie mediana jest przesuniÄ™ta w stronÄ™ niÅ¼szych wartoÅ›ci, co sugeruje asymetriÄ™ w kierunku spadkÃ³w.
3. WÄ…sy, ktÃ³re wychodzÄ… z pudeÅ‚ka, pokazujÄ… zakres danych, znajdujÄ…cych siÄ™ w obrÄ™bie 1.5-krotnoÅ›ci zakresu interkwartylowego. WÄ…sy wskazujÄ… na rozpiÄ™toÅ›Ä‡ danych, ignorujÄ…c wartoÅ›ci odstajÄ…ce. SzczegÃ³lnie stabilnÄ… inwestycjÄ… jest euro, gdzie wÄ…sy sÄ… krÃ³tkie, co sugeruje mniejsze odchylenie od mediany. Najmniej stabilnÄ… inwestycjÄ… wydaje siÄ™ byÄ‡ PKN, gdzie wÄ…sy sÄ… dÅ‚ugie, co wskazuje na duÅ¼e rozproszenie cen.
4. WartoÅ›ci odstajÄ…ce, ktÃ³re sÄ… reprezentowane jako punkty znajdujÄ…ce siÄ™ poza zasiÄ™giem wÄ…sÃ³w. Te obserwacje sÄ… wyraÅºnie rÃ³Å¼niÄ…ce siÄ™ od reszty danych i wskazujÄ… na nietypowe lub ekstremalne wartoÅ›ci w zbiorze. SzczegÃ³lnie ciekawym przypadkiem jest MCI, widzimy kilka wartoÅ›ci odstajÄ…cych, ktÃ³re wskazujÄ… na pojedyncze, duÅ¼e zmiany cen akcji w analizowanym okresie. Skrajnym przypadkiem jest tutaj ponad 8% wzrost dzienny. 
5. Dodatkowo, na podstawie dÅ‚ugoÅ›ci wÄ…sÃ³w i poÅ‚oÅ¼enia mediany, moÅ¼na oceniÄ‡ asymetriÄ™ rozkÅ‚adu. JeÅ›li wÄ…sy sÄ… nierÃ³wnej dÅ‚ugoÅ›ci, rozkÅ‚ad jest przesuniÄ™ty, co moÅ¼e sugerowaÄ‡ obecnoÅ›Ä‡ skoÅ›noÅ›ci. Wykres pudeÅ‚kowy pozwala rÃ³wnieÅ¼ na ocenÄ™ rozproszenia danych â€” szerokie pudeÅ‚ko wskazuje na wiÄ™ksze zrÃ³Å¼nicowanie, natomiast wÄ…skie pudeÅ‚ko sugeruje mniejsze rozproszenie. WyrÃ³Å¼niajÄ…cÄ… siÄ™ inwestycjÄ… jest w tym przypadku zÅ‚oto, ktÃ³rego wartoÅ›Ä‡ w badanym okresie stabilnie rosÅ‚a (brak dodatnich wartoÅ›ci odstajÄ…cych). 

Wykres pudeÅ‚kowy dostarcza wizualnych informacji o rozkÅ‚adzie zmiennej, umoÅ¼liwiajÄ…c identyfikacjÄ™ jej Å›redniej, zakresu, rozproszenia oraz wartoÅ›ci odstajÄ…cych, a takÅ¼e ocenÄ™ symetrii lub asymetrii danych.

```{r boxplot, eval=TRUE, echo = FALSE, fig.height=8, fig.align='center'}
p1 <- ggplot(euro_pln, aes(x = '', y = pct_change)) +
  geom_boxplot() +
  coord_flip() +
  ggtitle("EUR/PLN") +
  theme(axis.title.y = element_blank(), axis.title.x = element_blank()) +
  scale_y_continuous(labels = label_percent(scale = 1), limits = c(-5, 10))
p2 <- ggplot(mci_pln, aes(x = '', y = pct_change)) +
  geom_boxplot() +
  coord_flip() +
  ggtitle("MCI") +
  theme(axis.title.y = element_blank(), axis.title.x = element_blank()) +
  scale_y_continuous(labels = label_percent(scale = 1), limits = c(-5, 10))
p3 <- ggplot(pkn_pln, aes(x = '', y = pct_change)) +
  geom_boxplot() +
  coord_flip() +
  ggtitle("PKN") +
  theme(axis.title.y = element_blank(), axis.title.x = element_blank()) +
  scale_y_continuous(labels = label_percent(scale = 1), limits = c(-5, 10))
p4 <- ggplot(xau_pln, aes(x = '', y = pct_change)) +
  geom_boxplot() +
  coord_flip() +
  ggtitle("XAU/PLN") +
  theme(axis.title.y = element_blank(), axis.title.x = element_blank()) +
  scale_y_continuous(labels = label_percent(scale = 1), limits = c(-5, 10))

p1 / p2 / p3 / p4
```

### Statystyki opisowe
Tabela przedstawia statystyki opisowe dla czterech zmiennych: EUR/PLN (cena euro w zÅ‚otÃ³wkach), MCI (MCI Capital ASI SA, polska Alternatywna SpÃ³Å‚ka Inwestycyjna), PKN (spÃ³Å‚ka PKN Orlen) oraz XAU/PLN (cena uncji zÅ‚ota w polskich zÅ‚otych). KaÅ¼da z tych zmiennych reprezentuje istotny skÅ‚adnik portfela inwestycyjnego, a ich analiza pozwala oceniÄ‡ stabilnoÅ›Ä‡ oraz zmiennoÅ›Ä‡ poszczegÃ³lnych aktywÃ³w.

```{r stat_desc, eval=TRUE, echo = FALSE}
euro_pln_stat <- describe(euro_pln[, c("pct_change")])
mci_pln_stat <- describe(mci_pln[, c("pct_change")])
pkn_pln_stat <- describe(pkn_pln[, c("pct_change")])
xau_pln_stat <- describe(xau_pln[, c("pct_change")])

translation <- c(
  "mean" = "Åšrednia arytmetyczna (%)",
  "sd" = "Odchylenie standardowe (%)",
  "median" = "Mediana (%)",
  "trimmed" = "PrzyciÄ™ta Å›rednia (%)",
  "mad" = "Mediana bezwzglÄ™dnego odchylenia (%)",
  "min" = "Minimum (%)",
  "max" = "Maksimum (%)",
  "range" = "Zakres (%)",
  "skew" = "SkoÅ›noÅ›Ä‡",
  "kurtosis" = "Kurtoza",
  "se" = "BÅ‚Ä…d standardowy"
)


combined_stats <- t(rbind(euro_pln_stat, mci_pln_stat, pkn_pln_stat, xau_pln_stat))[-1:-2, ]
colnames(combined_stats) <- c("EUR/PLN", "MCI", "PKN", "XAU/PLN")
rownames(combined_stats) <- translation[rownames(combined_stats)]
kable(combined_stats, digits = 3)
```



*EUR/PLN: Åšrednia cena euro w zÅ‚otÃ³wkach wynosi -0.002, co oznacza, Å¼e Å›rednio w badanym okresie wartoÅ›Ä‡ euro wzglÄ™dem zÅ‚otÃ³wki lekko malaÅ‚a. Odchylenie standardowe na poziomie 0.256 wskazuje na umiarkowanÄ… zmiennoÅ›Ä‡ tej zmiennej. Mediana wynoszÄ…ca 0.002 sugeruje, Å¼e cena euro byÅ‚a w miarÄ™ stabilna w centralnej czÄ™Å›ci rozkÅ‚adu, mimo Å¼e wystÄ™powaÅ‚y okresowe wahania. SkoÅ›noÅ›Ä‡ wynoszÄ…ca -0.202 wskazuje na lekkÄ… asymetriÄ™ w stronÄ™ niÅ¼szych wartoÅ›ci. Kurtoza wynoszÄ…ca 0.933 sugeruje, Å¼e rozkÅ‚ad tej zmiennej nie jest zbyt spiczasty, co wskazuje na brak duÅ¼ych ekstremalnych zmian w cenie euro.

MCI: Åšrednia zmiana wartoÅ›ci akcji MCI Capital ASI SA wynosi 0.019, co oznacza niewielki, ale dodatni trend w analizowanym okresie. Jednak odchylenie standardowe na poziomie 1.553 jest bardzo wysokie, co wskazuje na duÅ¼Ä… zmiennoÅ›Ä‡ tej spÃ³Å‚ki. Taka zmiennoÅ›Ä‡ moÅ¼e byÄ‡ wynikiem specyfiki rynku alternatywnych inwestycji, ktÃ³re charakteryzujÄ… siÄ™ wiÄ™kszym ryzykiem. Mediana 0.000 oznacza, Å¼e w poÅ‚owie okresu zmiany byÅ‚y neutralne. SkoÅ›noÅ›Ä‡ wynoszÄ…ca 1.084 sugeruje, Å¼e rozkÅ‚ad jest przesuniÄ™ty w stronÄ™ wyÅ¼szych wartoÅ›ci, co moÅ¼e wskazywaÄ‡ na czÄ™stsze wiÄ™ksze wzrosty niÅ¼ spadki. Kurtoza na poziomie 4.842 potwierdza, Å¼e rozkÅ‚ad MCI ma ostry szczyt i czÄ™sto wystÄ™pujÄ… w nim duÅ¼e zmiany, zarÃ³wno w gÃ³rÄ™, jak i w dÃ³Å‚.

PKN: Åšrednia zmiana ceny akcji PKN Orlen wynosi -0.190, co wskazuje na ogÃ³lny spadek w analizowanym okresie. Odchylenie standardowe na poziomie 1.620 wskazuje na duÅ¼Ä… zmiennoÅ›Ä‡ tego aktywa. PKN, bÄ™dÄ…c duÅ¼Ä… spÃ³Å‚kÄ… na rynku paliwowym, moÅ¼e byÄ‡ naraÅ¼ona na wahania zwiÄ…zane z cenami surowcÃ³w i sytuacjÄ… geopolitycznÄ…, co moÅ¼e tÅ‚umaczyÄ‡ tÄ™ zmiennoÅ›Ä‡. Mediana wynoszÄ…ca -0.358 sugeruje, Å¼e spÃ³Å‚ka miaÅ‚a tendencjÄ™ do spadkÃ³w w wiÄ™kszej czÄ™Å›ci okresu, mimo Å¼e w pewnych momentach wystÄ™powaÅ‚y wzrosty. SkoÅ›noÅ›Ä‡ wynoszÄ…ca 0.319 wskazuje na umiarkowanÄ… asymetriÄ™ w stronÄ™ wyÅ¼szych wartoÅ›ci, a kurtoza 0.526 sugeruje, Å¼e rozkÅ‚ad tej zmiennej nie jest szczegÃ³lnie spiczasty, a wahania cen nie byÅ‚y ekstremalne.

XAU/PLN: Åšrednia cena uncji zÅ‚ota wynosi 0.139, co oznacza, Å¼e w badanym okresie cena zÅ‚ota wzrastaÅ‚a. ZÅ‚oto jest czÄ™sto traktowane jako aktywo bezpieczne, a jego cena moÅ¼e rosnÄ…Ä‡ w okresach niepewnoÅ›ci rynkowej. Odchylenie standardowe 0.972 wskazuje na umiarkowanÄ… zmiennoÅ›Ä‡, chociaÅ¼ zmiany cen zÅ‚ota nie byÅ‚y tak duÅ¼e jak w przypadku MCI czy PKN. Mediana wynoszÄ…ca 0.196 sugeruje, Å¼e zÅ‚oto miaÅ‚o tendencjÄ™ wzrostowÄ… w wiÄ™kszoÅ›ci okresu. SkoÅ›noÅ›Ä‡ wynoszÄ…ca -0.884 wskazuje na pewnÄ… asymetriÄ™ rozkÅ‚adu w stronÄ™ wyÅ¼szych wartoÅ›ci, co moÅ¼e sugerowaÄ‡, Å¼e w analizowanym okresie cena zÅ‚ota miaÅ‚a skÅ‚onnoÅ›Ä‡ do wiÄ™kszych wzrostÃ³w. Kurtoza 2.777 wskazuje, Å¼e rozkÅ‚ad tej zmiennej jest bardziej spiczasty niÅ¼ dla EUR/PLN czy PKN, co moÅ¼e sugerowaÄ‡ wiÄ™ksze skoki cenowe.

PodsumowujÄ…c, zmiennoÅ›Ä‡ w portfelu inwestycyjnym jest rÃ³Å¼na w zaleÅ¼noÅ›ci od skÅ‚adnika. Aktywa takie jak MCI i PKN charakteryzujÄ… siÄ™ wysokÄ… zmiennoÅ›ciÄ…, co moÅ¼e wiÄ…zaÄ‡ siÄ™ z wiÄ™kszym ryzykiem, ale takÅ¼e wiÄ™kszym potencjaÅ‚em zyskÃ³w. Z kolei EUR/PLN i XAU/PLN wydajÄ… siÄ™ byÄ‡ bardziej stabilne, z mniejszymi wahaniami, co moÅ¼e sugerowaÄ‡ niÅ¼sze ryzyko zwiÄ…zane z tymi skÅ‚adnikami portfela. ZmiennoÅ›Ä‡ MCI i PKN moÅ¼e byÄ‡ szczegÃ³lnie istotna dla inwestorÃ³w poszukujÄ…cych bardziej dynamicznych aktywÃ³w, podczas gdy EUR/PLN i XAU/PLN mogÄ… peÅ‚niÄ‡ rolÄ™ stabilizujÄ…cÄ… portfel.

## Portfel o minimalnym ryzyku

W analizie portfela o minimalnym ryzyku wykorzystano dane dotyczÄ…ce czterech aktywÃ³w: EUR/PLN, MCI, PKN oraz XAU/PLN. Celem analizy jest znalezienie takich proporcji inwestycji w poszczegÃ³lne aktywa, ktÃ³re zapewniÄ… najniÅ¼sze ryzyko portfela mierzone jako. DÄ…Å¼ymy tutaj do minimalizacjÄ™ ryzyka bez wzglÄ™du na stopÄ™ zwrotu. 

Portfel ten cechuje siÄ™ bardzo ciekawÄ…Â zaleÅ¼noÅ›ciÄ… - caÅ‚kowicie wyklucza z zÅ‚oto, a Å›rodki ulokowane zostaÅ‚y gÅ‚Ã³wnie w euro. Logarytmiczna stopa zwrotu z badanego okresu wynosiÅ‚a -0.004, co oznacza, Å¼e portfel ten byÅ‚ stabilny, ale nie przyniÃ³sÅ‚ rzadnych zyskÃ³w. Ryzyko tego portfela mierzone jako wariancja stop zwrotu wynosiÅ‚o 0.2396515. WspÃ³Å‚czynnik Sharpe'a wynosiÅ‚ -0.02, co oznacza, Å¼e portfel ten byÅ‚ nieefektywny, poniewaÅ¼ nie przyniÃ³sÅ‚ zyskÃ³w w stosunku do ryzyka. Ujemne Sharpe ratio oznacza, Å¼e zwrot z portfela jest mniejszy niÅ¼ stopa zwrotu z aktywÃ³w bez ryzyka, czyli inwestycja nie rekompensuje podjÄ™tego ryzyka. 

W poprzednim rozdziale wyznaczono wykresy pudeÅ‚kowe dla zmiennych i inwestycja najwiÄ™kszej iloÅ›ci Å›rodkÃ³w w euro ma sens biorÄ…c pod uwagÄ™ minimalnÄ… zmiennoÅ›Ä‡ kursu tej waluty w wybranym okresie. 

```{r min_risk_portfolio, eval=TRUE, echo = FALSE, fig.align='center'}
returns <- tibble(
  EURPLN = euro_pln$log_return,
  MCI = mci_pln$log_return,
  PKN = pkn_pln$log_return,
  XAU = xau_pln$log_return
)

# Calculate mean returns and covariance matrix
mean_returns <- colMeans(returns)
cov_matrix <- var(returns)
# Set up quadratic programming for minimum risk portfolio
n <- ncol(returns)
Dmat <- 2 * cov_matrix
dvec <- rep(0, n)
Amat <- cbind(rep(1, n), diag(n)) # Constraints: sum of 0 <= weights = 1
bvec <- c(1, rep(0, n))    # RHS for constraints

# Solve for weights of the minimum risk portfolio
result <- solve.QP(Dmat, dvec, Amat, bvec, meq = 1)
min_risk_weights <- result$solution * 100

# Calculate metrics
min_risk_return <- sum(min_risk_weights * mean_returns)  # Expected return
min_risk_volatility <- sqrt(
  t(min_risk_weights) %*% cov_matrix %*% min_risk_weights
)  # Risk
sharpe_ratio <- min_risk_return / min_risk_volatility  # Efficiency

# Print results
# cat("Weights of Minimum Risk Portfolio:\n")
# print(min_risk_weights)
# print(sum(min_risk_weights))
# cat("\nExpected Return of Minimum Risk Portfolio: ", min_risk_return, "\n")
# cat("Risk (Volatility) of Minimum Risk Portfolio: ", min_risk_volatility, "\n")
# cat("Sharpe Ratio of Minimum Risk Portfolio: ", sharpe_ratio, "\n")


pie_chart <- data.frame(
  category = c("EUR/PLN", "MCI", "PKN", "XAU/PLN"),
  value = min_risk_weights
)

pie_chart$legend_label <- paste0(
  pie_chart$category,
  " - ",
  round(pie_chart$value, 1),
  " %"
)

# Create the pie chart
ggplot(pie_chart, aes(x = "", y = value, fill = category)) +
  geom_bar(stat = "identity", width = 1, , color = "white") +
  coord_polar(theta = "y") +
  theme(plot.title = element_blank()) +
  theme_void() +
  scale_fill_manual(
    values = c(
      "EUR/PLN" = "#fc8686",
      "MCI" = "#8484ff",
      "PKN" = "#80ff80",
      "XAU/PLN" = "#ffd586"
    ),
    labels = pie_chart$legend_label
  )
```

## Portfel z maksymalnÄ… efektywnoÅ›ciÄ…

```{r max_eff_portfolio, eval=TRUE, echo = FALSE, fig.align='center'}
#importing data
ror <- read.csv("ror.csv", sep = ";", dec = ",")
#We choose three assets for further analysis 
portfolio4 <- ror[c(1, 2, 3, 4)]
#Variables for all calculations
gold <- portfolio4$gold
orlen <- portfolio4$orlen
fund <- portfolio4$fund
eur <- portfolio4$eur
#importing weights from file txt
weights4inv <- read.table("weights4inv.txt", dec = ".", header = TRUE, quote = "\"", stringsAsFactors = FALSE)
w1 <- as.numeric(weights4inv$W1)
w2 <- as.numeric(weights4inv$W2)
w3 <- as.numeric(weights4inv$W3)
w4 <- as.numeric(weights4inv$W4)
#calculating SD
s1 <- sd(gold)
s2 <- sd(orlen)
s3 <- sd(fund)
s4 <- sd(eur)
#Calculating corellation
corr12 <- cor(gold, orlen)
corr13 <- cor(gold, fund)
corr14 <- cor(gold, eur)
corr23 <- cor(orlen, fund)
corr24 <- cor(orlen, eur)
corr34 <- cor(fund, eur)
#calculating ip
iportfolio <- mean(gold) * w1 + mean(orlen) * w2 + mean(fund) * w3 + mean(eur) * w4
#portfolio risk
sdp <- sqrt(w1^2 * s1^2 + w2^2 * s2^2 + w3^2 * s3^2 + w4^2 * s4^2 +
              2 * w1 * w2 * s1 * s2 * corr12 + 
              2 * w1 * w3 * s1 * s3 * corr13 + 
              2 * w1 * w4 * s1 * s4 * corr14 + 
              2 * w2 * w3 * s2 * s3 * corr23 + 
              2 * w2 * w4 * s2 * s4 * corr24 + 
              2 * w3 * w4 * s3 * s4 * corr34)
#calculating effectiveness
rf <- 0
sharp <- (iportfolio - rf) / sdp
#preparing df with results
data <- data.frame(w1 = w1, w2 = w2, w3 = w3, w4 = w4, iportfolio = iportfolio, sdp = sdp, sharp = sharp)
#finding interesting portfolios
min.risk <- subset(data, data$sdp == min(data$sdp))
max.effectivness <- subset(data, data$sharp == max(data$sharp))
max.ip <- subset(data, data$iportfolio == max(data$iportfolio))
max.w1 <- subset(data, data$w1 == 1)
max.w2 <- subset(data, data$w2 == 1)
max.w3 <- subset(data, data$w3 == 1)
max.w4 <- subset(data, data$w4 == 1)
descriptions <- c("Minimal risk portfolio", "Maximum efficiency portfolio", "Maximum rate of return portfolio", 
                  "Max weight one portfolio", "Max weight two portfolio", 
                  "Max weight three portfolio", "Max weight four portfolio")
#Combining results
results <- rbind(min.risk, max.effectivness, max.ip, max.w1, max.w2, max.w3, max.w4)
results$description <- descriptions
#Reordering columns
results <- results[, c("description", "w1", "w2", "w3", "w4", "iportfolio", "sdp", "sharp")]

# Saving results to CSV
write.csv(results, file = "results.csv", row.names = FALSE)

# Display results
results
# Filtering data for "Maximum efficiency portfolio"
max_efficiency <- results[results$description == "Maximum efficiency portfolio", ]

# Tworzenie danych do wykresu koÅ‚owego
pie_chart <- data.frame(
  category = c("XAU/PLN", "PKN", "MCI", "EUR/PLN"),
  value = as.numeric(max_efficiency[1, c("w1", "w2", "w3", "w4")])
)

# Dodanie legendy z etykietami (Å‚Ä…cznie z kategoriami o wadze 0)
pie_chart$legend_label <- paste0(
  pie_chart$category,
  " - ",
  round(pie_chart$value * 100, 1),
  " %"
)

# Ustawienie kolorÃ³w w odpowiedniej kolejnoÅ›ci
fill_colors <- c(
  "#fc8686",  # Kolor dla XAU/PLN
  "#8484ff"   # Kolor dla PKN
)

# Przygotowanie danych (usunÄ™liÅ›my kategorie z 0%)
pie_chart <- data.frame(
  category = c("XAU/PLN"),  # Tylko kategoria XAU/PLN z wartoÅ›ciÄ… 100%
  value = c(100),  # XAU/PLN ma 100%
  legend_label = c("XAU/PLN - 100 %")  # Etykieta legendy
)

# Tworzenie wykresu koÅ‚owego z zachowaniem wszystkich kategorii w legendzie
ggplot(pie_chart, aes(x = "", y = value, fill = category)) +
  geom_bar(stat = "identity", width = 1, color = "white") +
  coord_polar(theta = "y") +
  theme_void() +
  scale_fill_manual(
    values = fill_colors,
    labels = c("XAU/PLN - 100 %", "PKN - 0 %")  # PokaÅ¼emy takÅ¼e kategoriÄ™ z 0% w legendzie
  ) +
  ggtitle("Maximum Efficiency Portfolio")


```

## Cechy Portfela o Maksymalnej EfektywnoÅ›ci

### Wagi AktywÃ³w
- **ZÅ‚oto - XAU/PLN (w1):** 100% (caÅ‚oÅ›Ä‡ portfela ulokowana w EUR/PLN).
- **PKN Orlen (w2):** 0%.
- **MCI (w3):** 0%.
- **EUR/PLN (w4):** 0%.

Wynika z tego, Å¼e portfel caÅ‚kowicie koncentruje siÄ™ na jednym aktywie - **ZÅ‚oto - XAU/PLN **.

### Oczekiwany Zwrot
- Åšredni zwrot portfela wynosi okoÅ‚o **0.0013 (0.13%)**.

### Ryzyko Portfela (Odchylenie Standardowe)
- Ryzyko (SD) wynosi okoÅ‚o **0.0099 (0.99%)**, co czyni ten portfel relatywnie niskoryzykownym.

### WskaÅºnik Sharpe'a
- WskaÅºnik Sharpe'a wynosi okoÅ‚o **0.1312**, co wskazuje na umiarkowanÄ… efektywnoÅ›Ä‡ tego portfela w stosunku do poziomu ryzyka.

### Opis Alokacji
WybÃ³r tego portfela oznacza maksymalizacjÄ™ wskaÅºnika Sharpe'a, co moÅ¼e byÄ‡ odpowiednie dla inwestorÃ³w poszukujÄ…cych rÃ³wnowagi pomiÄ™dzy zwrotem a ryzykiem przy minimalnym zaangaÅ¼owaniu w bardziej ryzykowne aktywa.

---

### Zalety Tego Portfela
- **Niskie ryzyko:** CaÅ‚kowita koncentracja na zÅ‚ocie, ktÃ³re w analizach historycznych cechuje siÄ™ niskÄ… zmiennoÅ›ciÄ….
- **Prostota:** Brak dywersyfikacji oznacza brak potrzeby zarzÄ…dzania wieloma aktywami.

---

### Wady Tego Portfela
- **Brak dywersyfikacji:** Portfel jest caÅ‚kowicie uzaleÅ¼niony od wynikÃ³w zÅ‚ota, co zwiÄ™ksza ryzyko systematyczne (specyficzne dla tego rynku).
- **Potencjalnie niÅ¼szy zwrot:** Skoncentrowanie na jednym aktywie o niskiej zmiennoÅ›ci moÅ¼e ograniczaÄ‡ moÅ¼liwoÅ›ci uzyskania wyÅ¼szych zyskÃ³w





## WartoÅ›Ä‡ wspÃ³Å‚czynnikÃ³w korelacji dla analizowanych inwestycji 
**Korelacja** to miara statystyczna, ktÃ³ra pokazuje, w jakim stopniu dwie zmienne sÄ… ze sobÄ… powiÄ…zane. WartoÅ›Ä‡ korelacji wskazuje na siÅ‚Ä™ i kierunek zaleÅ¼noÅ›ci miÄ™dzy zmiennymi:

- **Korelacja dodatnia (pozytywna)**: Kiedy jedna zmienna roÅ›nie, druga rÃ³wnieÅ¼ roÅ›nie.
- **Korelacja ujemna (negatywna)**: Kiedy jedna zmienna roÅ›nie, druga maleje.
- **Brak korelacji**: Brak jakiejkolwiek zaleÅ¼noÅ›ci miÄ™dzy zmiennymi.

WartoÅ›Ä‡ korelacji mieÅ›ci siÄ™ w zakresie od **-1 do 1**:
- **1**: Perfekcyjna dodatnia korelacja â€” zmienne poruszajÄ… siÄ™ w tej samej fazie.
- **-1**: Perfekcyjna ujemna korelacja â€” zmienne poruszajÄ… siÄ™ w przeciwnych kierunkach.
- **0**: Brak korelacji â€” zmienne sÄ… niezaleÅ¼ne.

```{r  korelacja , eval=TRUE, echo = FALSE, fig.align='center'}
returns <- tibble(
  EURPLN = euro_pln$log_return,
  MCI = mci_pln$log_return,
  PKN = pkn_pln$log_return,
  XAU = xau_pln$log_return
)

# Obliczanie macierzy korelacji dla logarytmicznych stÃ³p zwrotu
cor_matrix <- cor(returns)

# WyÅ›wietlanie wynikÃ³w
print(cor_matrix)

# Tworzenie ciepÅ‚ej mapy korelacji
ggcorrplot(cor_matrix, 
           method = "circle", 
           type = "lower", 
           lab = TRUE, 
           lab_size = 3, 
           colors = c("blue", "white", "red"))

```

## Interpretacja korelacji

1. **Korelacja miÄ™dzy EURPLN a innymi zmiennymi:**
   - **EURPLN â†” MCI**: WspÃ³Å‚czynnik korelacji wynosi -0.183, co wskazuje na **sÅ‚abÄ… ujemnÄ… korelacjÄ™** miÄ™dzy tymi dwiema zmiennymi. Oznacza to, Å¼e wzrost wartoÅ›ci EURPLN jest lekko zwiÄ…zany ze spadkiem wartoÅ›ci MCI.
   - **EURPLN â†” PKN**: Korelacja wynosi 0.029, co oznacza, Å¼e **brak jest istotnej korelacji** pomiÄ™dzy tymi zmiennymi.
   - **EURPLN â†” XAU**: Korelacja wynosi 0.270, co wskazuje na **sÅ‚abÄ… dodatniÄ… korelacjÄ™**. Wzrost wartoÅ›ci EURPLN jest nieznacznie powiÄ…zany z wzrostem wartoÅ›ci XAU.

2. **Korelacja miÄ™dzy MCI a innymi zmiennymi:**
   - **MCI â†” PKN**: Korelacja wynosi 0.038, co oznacza, Å¼e istnieje **bardzo sÅ‚aba dodatnia korelacja** miÄ™dzy tymi zmiennymi, praktycznie brak zauwaÅ¼alnej zaleÅ¼noÅ›ci.
   - **MCI â†” XAU**: WspÃ³Å‚czynnik korelacji wynosi 0.115, co sugeruje **sÅ‚abÄ… dodatniÄ… korelacjÄ™** miÄ™dzy MCI a XAU, choÄ‡ nie jest to znaczÄ…ca zaleÅ¼noÅ›Ä‡.

3. **Korelacja miÄ™dzy PKN a XAU:**
   - **PKN â†” XAU**: Korelacja wynosi 0.037, co wskazuje na **bardzo sÅ‚abÄ… dodatniÄ… korelacjÄ™** pomiÄ™dzy tymi dwiema zmiennymi. Zmiany w wartoÅ›ci PKN majÄ… minimalny wpÅ‚yw na zmiany w wartoÅ›ci XAU.

---

## Podsumowanie

- **Najsilniejsza korelacja** to korelacja miÄ™dzy EURPLN a XAU, ktÃ³ra wynosi 0.270, wskazujÄ…c na niewielkÄ…, ale zauwaÅ¼alnÄ… dodatniÄ… zaleÅ¼noÅ›Ä‡.
- WartoÅ›ci korelacji miÄ™dzy pozostaÅ‚ymi parami zmiennych sÄ… sÅ‚abe lub praktycznie zerowe, co oznacza, Å¼e zmienne te nie wykazujÄ… silnych powiÄ…zaÅ„ ze sobÄ….

## WskaÅºniki efektywnoÅ›ci

```{r eval=TRUE, echo = FALSE, fig.align='center'}}

#importing data
ror <- read.csv("ror.csv", sep=";", dec=",")
#Variables for all calculations
gold <- ror$gold
orlen <- ror$orlen
fund <- ror$fund
eur <- ror$eur

investment_returns <- data.frame(
  Gold = rnorm(gold),  # Inwestycja 1
  Orlen = rnorm(orlen), # Inwestycja 2
  Fund = rnorm(fund), # Inwestycja 3
  Euro = rnorm(eur) # Inwestycja 4
)
install.packages("xts")
library(xts)

dates <- seq(as.Date("2024-07-01"), by = "day", length.out = 106)
investment_returns_xts <- xts(investment_returns, order.by = dates)

library(PerformanceAnalytics)

any(is.na(investment_returns_xts))

RF <- 0.04/252
PodwÃ³jnySharpe <- round(SharpeRatio.annualized(R = investment_returns_xts, Rf = RF, 
                                        scale = 252, geometric = FALSE), digits = 3)

MARR <- 0.04
sortino <- round(SortinoRatio(R = investment_returns_xts, MAR = MARR), digits = 3)

calmar <- round(CalmarRatio(R = investment_returns_xts), digits = 3)

# Dane z wynikÃ³w
PodwÃ³jnySharpe <- c(3.015, -0.384, -0.614, -1.083)
sortino <- c(0.232, -0.091, -0.1, -0.144)
calmar <- c(-0.998, -0.925, -0.424, -0.708)

# Nazwy kolumn
nazwy <- c("Gold", "Orlen", "Fund", "Euro")

# Tworzenie ramki danych
wyniki <- data.frame(
  Metric = c("Annualized Sharpe Ratio (Rf=4%)", "Sortino Ratio (MAR=4%)", "Calmar Ratio"),
  Gold = c(PodwÃ³jnySharpe[1], sortino[1], calmar[1]),
  Orlen = c(PodwÃ³jnySharpe[2], sortino[2], calmar[2]),
  Fund = c(PodwÃ³jnySharpe[3], sortino[3], calmar[3]),
  Euro = c(PodwÃ³jnySharpe[4], sortino[4], calmar[4])
)

# Drukowanie tabeli
print(wyniki)

```

## ZbiÃ³r moÅ¼liwoÅ›ci inwestycyjnych

Przedstawia wszystkie moÅ¼liwoÅ›ci kombinacji portfela inwestycyjnego z poszczegÃ³lnych ryzykownych aktywÃ³w. Na wykresie widoczna jest oÅ› X, na ktÃ³rej znajduje siÄ™ ryzyko oraz oczekiwanÄ… stopÄ™ zwrotu na osi Y. PostaÄ‡ graficzna pozwala na identyfikacjÄ™ optymalnych portfeli, w tym miÄ™dzy innymi portfela o minimalnym ryzyku oraz portfela o maksymalnej efektywnoÅ›ci. Niebieski obszar reprezentuje wszystkie moÅ¼liwoÅ›ci kombinacji portfeli utworzonych z dostÄ™pnych aktywÃ³w ryzykownych, kaÅ¼dy zaznaczony punkt odpowiada innemu portfelowi. Zielony punkt wskazuje na portfel minimalnego ryzyka, o najniÅ¼szym poziomie odchylenia standardowego w caÅ‚ym dostÄ™pnym zbiorze. Czerwona kropka przedstawia portfel o maksymalnej efektywnoÅ›ci, ktÃ³ry oferuje najwyÅ¼szÄ… oczekiwanÄ… stopÄ™ zwrotu w stosunku do ryzyka. Czarne punkty na wykresie oznaczajÄ… portfele jednoelementowe, ktÃ³re skÅ‚adajÄ… siÄ™ w 100% z jednego poszczegÃ³lnego aktywa. Dodatkowo na wykresie znajduje siÄ™ fioletowa krzywa, ktÃ³ra reprezentuje granicÄ™ efektywnÄ…, czyli zbiÃ³r portfeli, ktÃ³re sÄ… optymalne i oferujÄ… najwyÅ¼szÄ… oczekiwanÄ… stopÄ™ zwrotu dla okreÅ›lonego poziomu ryzyka.

```{r echo=FALSE, fig.align='center'}
#importing data
ror <- read.csv("ror.csv", sep=";", dec=",")
#We choose three assets for further analysis 
portfolio4 <- ror[c(1, 2, 3, 4)]
#Variables for all calculations
gold <- portfolio4$gold
orlen <- portfolio4$orlen
fund <- portfolio4$fund
eur <- portfolio4$eur
#importing weights from file txt
weights4inv <- read.table("weights4inv.txt",dec=".", header=TRUE, quote="\"",stringsAsFactors=FALSE)
w1 <- weights4inv$W1
w1 <- as.numeric(w1)
w2 <- weights4inv$W2
w2 <- as.numeric(w2)
w3 <- weights4inv$W3
w3 <- as.numeric(w3)
w4 <- weights4inv$W4
w4 <- as.numeric(w4)
#calculating SD
s1 <- sd(gold)
s2 <- sd(orlen)
s3 <- sd(fund)
s4 <- sd(eur)
#Calculating corellation
corr12 <- cor(gold,orlen)
corr13 <- cor(gold,fund)
corr14 <- cor(gold, eur)
corr23 <- cor(orlen, fund)
corr24 <- cor(orlen, eur)
corr34 <- cor(fund, eur)
#calculating ip
iportfolio <- mean(gold)*w1+mean(orlen)*w2+mean(fund)*w3+mean(eur)*w4
#portfolio risk
sdp <- (w1^2*s1^2 + w2^2*s2^2 + w3^2*s3^2 + w4^2*s4^2 + 2*w1*w2*s1*s2*corr12 + 2*w1*w3*s1*s3*corr13 + 2*w1*w4*s1*s4*corr14 + 
          2*w2*w3*s2*s3*corr23 + 2*w2*w4*s2*s4*corr24 + 2*w3*w4*s3*s4*corr34)^0.5
#calculating effectivness
rf <- 0
sharp <- (iportfolio-rf)/sdp
#preparing df with results
data <- cbind(w1, w2, w3, w4, iportfolio, sdp, sharp)
data <- as.data.frame(data)
#finding interesting portfolios
min.risk <- subset(data, data$sdp==min(data$sdp))
max.effectivness <- subset(data, data$sharp==max(data$sharp))
max.ip <- subset(data, data$iportfolio==max(data$iportfolio))
max.w1 <- subset(data, data$w1==1)
max.w2 <- subset(data, data$w2==1)
max.w3 <- subset(data, data$w3==1)
max.w4 <- subset(data, data$w4==1)
des <- c("Minimal risk portfolio", "Maximum efficiency portfolio", "Maximum rate of return portfolio", "Max weight one portfolio", "Max weight two portfolio", "Max weight three portfolio", "Max weight four portfolio")
#Creating table with results 3 portfolios and showing results in console
results <- cbind(rbind(min.risk, max.effectivness, max.ip, max.w1, max.w2, max.w3, max.w4), des)
write.csv(x=results, file = "results.csv", row.names=FALSE)

plot(sdp, iportfolio, type= "p", col = "#98B6D5")
xlim = c(0, 0.02)
title(main="Opportunity set for four risky assets without SS")
points(min.risk$sdp, min.risk$iportfolio, pch=19, col="#4FC46A", cex = 2.5)
points(max.effectivness$sdp, max.effectivness$iportfolio, pch=16, col="#C81518", cex = 2.5)
points(max.ip$sdp, max.ip$iportfolio, pch=19, col="yellow", cex = 1)
points(max.w1$sdp, max.w1$iportfolio, pch=19, col="black")
points(max.w2$sdp, max.w2$iportfolio, pch=19, col="black")
points(max.w3$sdp, max.w3$iportfolio, pch=19, col="black")
points(max.w4$sdp, max.w4$iportfolio, pch=19, col="black")
grid(col = "gray", lty = "dotted")
       
sorted <- data.frame(sdp = sdp, iportfolio = iportfolio)
sorted <- sorted[order(sorted$sdp), ]
efficient_frontier <- sorted[sorted$iportfolio == cummax(sorted$iportfolio), ]

# Rysowanie granicy efektywnej
lines(efficient_frontier$sdp, efficient_frontier$iportfolio, col = "#A61B96", lwd = 3)

```

## Portfel o maksymalnym zysku z uwzglÄ™dnieniem sprzedaÅ¼y krÃ³tkiej

Uzyskanie portfela zapewniajÄ…cego maksymalny zysk z uwzglÄ™dnieniem krÃ³tkiej sprzedaÅ¼y daje bardzo ciekawe efekty. Jako Å¼e Orlen w caÅ‚ym badanym okresie byÅ‚ w tendencji spadkowej i straciÅ‚ na wartoÅ›ci akcji ponad 10 zÅ‚otych, czyli okoÅ‚o 20%. KomponujÄ…c portfel bazujÄ…c na krÃ³tkiej sprzedaÅ¼y spÃ³Å‚ki orlen, uzyskujemy w sumie skumulowanÄ… wartoÅ›Ä‡ stopy logarytmicznej na poziomie 0.21. Ryzyko tego porfela wyraÅ¼one odchyleniem standardowym wynosi 0.016. WspÃ³Å‚czynnik Sharpe'a wynosiÅ‚ 13.2832, co oznacza, Å¼e portfel ten byÅ‚ bardzo efektywny - przyniÃ³sÅ‚ wysokie zyski w stosunku do ryzyka. OczywiÅ›cie takie wyniki sÄ… bardzo trudne do osiÄ…gniÄ™cia w praktyce, ale pokazujÄ…, Å¼e krÃ³tka sprzedaÅ¼ moÅ¼e byÄ‡ skutecznÄ… strategiÄ… inwestycyjnÄ… w okreÅ›lonych warunkach rynkowych.

```{r short_selling, eval = TRUE, echo = FALSE}
returns <- tibble(
  EURPLN = euro_pln$log_return,
  MCI = mci_pln$log_return,
  PKN = pkn_pln$log_return,
  XAU = xau_pln$log_return
)

cov_matrix <- cov(returns)
mean_returns <- colMeans(returns)

Dmat <- cov_matrix  # Covariance matrix, represents risk
dvec <- -mean_returns    # Negative of expected returns (since we are maximizing the return)
Amat <- cbind(1, diag(1, nrow = length(returns)))  # Constraint matrix, sum(w) = 1 and short selling (w >= -1)
bvec <- c(1, rep(0, length(returns)))  # Constraints: sum(w) = 1, w >= -1 for short selling

# Solve the quadratic programming problem
solution <- solve.QP(Dmat, dvec, Amat, bvec, meq = 1)

optimal_weights <- round(solution$solution, 2)
# optimal_weights
return_rate <- -sum(optimal_weights * t(returns))
# return_rate
percent_return <- (exp(return_rate) - 1) * 100
# percent_return
# 2. Calculate the portfolio risk (standard deviation)
portfolio_variance <- t(optimal_weights) %*% cov_matrix %*% optimal_weights
portfolio_risk <- sqrt(portfolio_variance)

# 3. Calculate the Sharpe Ratio (assuming a risk-free rate of 0 for simplicity)
sharpe_ratio <- return_rate / portfolio_risk

# Print the results
# cat("Expected Return Rate: ", return_rate, "\n")
# cat("Portfolio Risk (Standard Deviation): ", portfolio_risk, "\n")
# cat("Sharpe Ratio: ", sharpe_ratio, "\n")

# cat(sum(pkn_pln$log_return))
```


```{r , eval=TRUE, echo = FALSE, fig.align='center'}
# Importowanie wymaganych pakietÃ³w
library(ggplot2)
library(tidyr)
library(dplyr)
library(PerformanceAnalytics)

# Wczytanie danych stÃ³p zwrotu
ror <- read.csv("ror.csv", sep = ";", dec = ",")
portfolio_assets <- ror[c("gold", "orlen", "fund", "eur")]

# Liczba okresÃ³w do analizy (np. miesiÄ™czne przesuniÄ™cie)
rolling_window <- 30  # 30 dni dla miesiÄ™cznej analizy

# Tworzenie pustej ramki danych na wyniki
results_df <- data.frame()

# Iteracyjne wyznaczanie optymalnych portfeli dla przesuwajÄ…cego siÄ™ okna czasowego
for (i in 1:(nrow(portfolio_assets) - rolling_window)) {
  window_data <- portfolio_assets[i:(i + rolling_window - 1), ]

  # Åšrednie stopy zwrotu i macierz kowariancji
  mean_returns <- colMeans(window_data)
  cov_matrix <- cov(window_data)

  # Optymalne wagi portfela minimalizujÄ…cego ryzyko
  inv_cov <- solve(cov_matrix)
  ones <- rep(1, ncol(window_data))
  w_min_var <- inv_cov %*% ones / sum(inv_cov %*% ones)
  
  # Oczekiwane stopy zwrotu i ryzyko
  port_return <- sum(w_min_var * mean_returns)
  port_risk <- sqrt(t(w_min_var) %*% cov_matrix %*% w_min_var)

  # Zapis wynikÃ³w dla danego okresu
  results_df <- rbind(results_df, data.frame(
    Period = i,
    Return = port_return,
    Risk = port_risk
  ))
}

# Wykres efektywnej granicy portfela w czasie
ggplot(results_df, aes(x = Risk, y = Return, color = Period)) +
  geom_point() +
  geom_smooth(se = FALSE, method = "loess") +
  scale_color_gradient(low = "blue", high = "red") +
  labs(title = "Zmiany efektywnych portfeli w czasie",
       x = "Ryzyko portfela (%)",
       y = "Stopa zwrotu (%)") +
  theme_minimal()


```

# Interpretacja wynikÃ³w
1.**Co przedstawia wykres?** 
Wykres przedstawia, jak **optymalne portfele inwestycyjne zmieniajÄ… siÄ™ w czasie**, analizujÄ…c zaleÅ¼noÅ›Ä‡ miÄ™dzy **ryzykiem a stopÄ… zwrotu**.

2.**Elementy wykresu ** 
- **Punkty** ðŸŸ£ðŸ”´ â†’ ReprezentujÄ… optymalne portfele w kolejnych okresach.
  - Kolor oznacza **moment w czasie**.
  - **Niebieskie punkty** to wczeÅ›niejsze okresy.
  - **Czerwone punkty** to najnowsze okresy.
- **OÅ› X (Ryzyko portfela [%])** â†’ Mierzy poziom zmiennoÅ›ci.
- **OÅ› Y (Stopa zwrotu [%])** â†’ Oczekiwana rentownoÅ›Ä‡.
- **Niebieska linia** â†’ Trend zmian portfeli w czasie.

3.**Wnioski** 
- Portfele o niskim ryzyku miaÅ‚y poczÄ…tkowo stosunkowo wysokie stopy zwrotu, ale trend ten zmieniaÅ‚ siÄ™ z czasem.
- WystÄ™pujÄ… okresy **spadku efektywnoÅ›ci portfeli**, ale takÅ¼e momenty poprawy.
- Kolory pomagajÄ… zrozumieÄ‡, ktÃ³re momenty byÅ‚y bardziej korzystne.

4.**Podsumowanie** 
Wykres ten pozwala analizowaÄ‡ **ewolucjÄ™ efektywnych portfeli** i identyfikowaÄ‡ okresy bardziej oraz mniej optymalne dla inwestorÃ³w.

## SkÅ‚ad portfeli z granicy efektywnej

```{r eval=TRUE, echo = FALSE, fig.align='center'}}

library(lpSolve)
library(fPortfolio)

data <- investment_returns_xts[, c("Gold", "Orlen", "Fund", "Euro")]

class(data)

data <- as.timeSeries(data)

data <- covEstimator(data)

shortSpec <- portfolioSpec()

setSolver(shortSpec) <- "solveRshortExact"

shortFrontier <- portfolioFrontier(data, constraints="LongOnly")

weightsPlot(shortFrontier,labels = TRUE, col = NULL)

```

## Podsumowanie

Analiza dotyczÄ…ca portfela inwestycyjnego zÅ‚oÅ¼onego z czterech aktywÃ³w, w tym: zÅ‚ota, euro, funduszu MCI i akcji PKN Orlen, zbadanych w okresie od lipca do listopada 2024 roku pozwoliÅ‚a oceniÄ‡ efektywnoÅ›Ä‡ portfela oraz ryzyko wiÄ…Å¼Ä…ce siÄ™ z poszczegÃ³lnych skÅ‚adnikÃ³w. Fundusz MCI i akcje PKN charakteryzujÄ… siÄ™ wysokÄ… zmiennoÅ›ciÄ…, co wpÅ‚ywa na podwyÅ¼szone ryzyko, podczas gdy euro i zÅ‚oto sÄ… bardziej stabilne, co sugeruje niÅ¼sze ryzyko. W ramach analizy portfela o minimalnym ryzyku najwiÄ™cej Å›rodkÃ³w zainwestowano w euro, co zapewniÅ‚o niski poziom zmiennoÅ›ci. Z kolei portfel o maksymalnej efektywnoÅ›ci skoncentrowaÅ‚ siÄ™ na zÅ‚ocie, oferujÄ…c umiarkowanÄ… efektywnoÅ›Ä‡ w stosunku do ryzyka. Analiza korelacji miÄ™dzy aktywami wykazaÅ‚a gÅ‚Ã³wnie sÅ‚abe zaleÅ¼noÅ›ci, a interesujÄ…cym przypadkiem byÅ‚a strategia krÃ³tkiej sprzedaÅ¼y akcji PKN, ktÃ³ra przy wysokim wspÃ³Å‚czynniku Sharpe'a wykazaÅ‚a duÅ¼Ä… efektywnoÅ›Ä‡ w analizowanym okresie. WaÅ¼ne jest zrozumienie wzajemnych zaleÅ¼noÅ›ci miÄ™dzy aktywami oraz Å›wiadome podejmowanie decyzji inwestycyjnych, aby uzyskaÄ‡ najlepszy wynik przy optymalnym poziomie ryzyka.





## Bibliografia

1.  UrzÄ…d Komisji Nadzoru Finansowego. â€œKNF.â€ *Knf.gov.pl*, 2024, [www.knf.gov.pl/dla_rynku/procesy_licencyjne/kapitalowy/zarzadzajacy_alternatywnymi_spolkami_inwestycyjnymi_ZASI/pytania_i_odpowiedzi. Accessed 8 Jan. 2025](http://www.knf.gov.pl/dla_rynku/procesy_licencyjne/kapitalowy/zarzadzajacy_alternatywnymi_spolkami_inwestycyjnymi_ZASI/pytania_i_odpowiedzi.%20Accessed%208%20Jan.%202025).
2.  â€œOpportunity Set Definition and Tutorial for Investment Modeling \| FactorPad.â€ *Factorpad.com*, factorpad.com/fin/glossary/opportunity-set.html.
3.  â€œMCI - MCI Capital ASI SA - Stooq.â€ *Stooq*, 2025, stooq.pl/q/p/?s=mci&fbclid=IwZXh0bgNhZW0CMTEAAR1EYBwR60o75nUTSQ3b-95iZ-nU2zflpBnvTctKiazgGsZhliUjWwLx0n0_aem_Nennkxm8HU8jLqFlHg0vJA. Accessed 8 Jan. 2025.
